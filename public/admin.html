<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Penta Subathon Timer - Admin Panel</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
      padding: 15px;
      font-size: 14px;
    }

    .admin-container {
      background: rgba(20, 25, 40, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      max-width: 1400px;
      margin: 0 auto;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .header h1 {
      color: #ffffff;
      font-size: 2rem;
      margin-bottom: 5px;
      background: linear-gradient(45deg, #60a5fa, #a78bfa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header p {
      color: #9ca3af;
      font-size: 1rem;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .timer-section {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      color: white;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .timer-display {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 10px;
      font-family: 'Courier New', monospace;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .timer-status {
      font-size: 1rem;
      margin-bottom: 15px;
      opacity: 0.9;
    }

    .timer-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 700;
      transition: box-shadow 0.2s ease;
      position: relative;
      overflow: hidden;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 3px 10px rgba(102, 126, 234, 0.2);
    }

    .btn:hover {
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }

    .btn:active {
      box-shadow: 0 2px 6px rgba(102, 126, 234, 0.2);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: 0 2px 6px rgba(102, 126, 234, 0.1);
    }

    .btn.success {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      box-shadow: 0 3px 10px rgba(16, 185, 129, 0.2);
    }

    .btn.success:hover {
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
    }

    .btn.danger {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      box-shadow: 0 3px 10px rgba(239, 68, 68, 0.2);
    }

    .btn.danger:hover {
      box-shadow: 0 4px 12px rgba(239, 68, 68, 0.25);
    }

    .btn.secondary {
      background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
      box-shadow: 0 3px 10px rgba(107, 114, 128, 0.2);
    }

    .btn.secondary:hover {
      box-shadow: 0 4px 12px rgba(107, 114, 128, 0.25);
    }

    .btn.info {
      background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
      box-shadow: 0 3px 10px rgba(6, 182, 212, 0.2);
    }

    .btn.info:hover {
      box-shadow: 0 4px 12px rgba(6, 182, 212, 0.25);
    }

    .settings-panel {
      background: rgba(30, 41, 59, 0.9);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      height: fit-content;
    }

    .settings-panel h3 {
      color: #ffffff;
      margin-bottom: 15px;
      font-size: 1.2rem;
    }

    .settings-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }

    .setting-group {
      margin-bottom: 12px;
    }

    .setting-group label {
      display: block;
      margin-bottom: 5px;
      color: #d1d5db;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .setting-group input {
      width: 100%;
      padding: 8px;
      border: 2px solid #4b5563;
      border-radius: 8px;
      font-size: 0.9rem;
      transition: border-color 0.3s ease;
      background: rgba(17, 24, 39, 0.8);
      color: #ffffff;
    }

    .setting-group input:focus {
      outline: none;
      border-color: #60a5fa;
      box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2);
    }

    .quick-controls {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .quick-add-btn {
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      transition: box-shadow 0.2s ease;
      background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
      box-shadow: 0 2px 8px rgba(139, 92, 246, 0.2);
      flex: 1;
      min-width: 70px;
    }

    .quick-add-btn:hover {
      box-shadow: 0 3px 10px rgba(139, 92, 246, 0.25);
    }

    .quick-add-btn:active {
      box-shadow: 0 2px 6px rgba(139, 92, 246, 0.2);
    }

    .manual-timer-controls {
      margin-top: 15px;
      padding: 15px;
      border-top: 2px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
    }

    .manual-timer-inputs {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
      background: rgba(255, 255, 255, 0.15);
      padding: 15px;
      border-radius: 12px;
      backdrop-filter: blur(5px);
    }

    .time-input-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .time-input-group input {
      width: 70px;
      height: 45px;
      padding: 10px 8px;
      border: 2px solid rgba(255, 255, 255, 0.4);
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.95);
      color: #333;
      font-size: 1.1rem;
      font-weight: bold;
      text-align: center;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
    }

    .time-input-group input:focus {
      outline: none;
      border-color: #4CAF50;
      box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2), 0 2px 6px rgba(0, 0, 0, 0.1);
      background: white;
    }

    .time-input-group input:hover {
      border-color: rgba(255, 255, 255, 0.6);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    .time-input-group label {
      color: rgba(255, 255, 255, 0.95);
      font-size: 0.8rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }

    .time-separator {
      color: white;
      font-size: 1.8rem;
      font-weight: bold;
      margin: 0 8px;
      opacity: 0.9;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
      margin-top: -20px;
    }

    .content-grid {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 20px;
    }

    .styling-section {
      background: rgba(30, 41, 59, 0.9);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .styling-section h3 {
      color: #ffffff;
      margin-bottom: 12px;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .styling-controls {
      display: flex;
      flex-direction: column;
      gap: 12px;
      flex: 1;
    }

    .styling-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .styling-group.half {
      flex: 1;
    }

    .styling-row {
      display: flex;
      gap: 10px;
    }

    .styling-group label {
      color: #d1d5db;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .styling-group input[type="color"] {
      width: 60px;
      height: 35px;
      border: 2px solid #4b5563;
      border-radius: 6px;
      cursor: pointer;
      background: rgba(17, 24, 39, 0.8);
    }

    .styling-group input[type="color"]::-webkit-color-swatch-wrapper {
      padding: 0;
    }

    .styling-group input[type="color"]::-webkit-color-swatch {
      border: none;
      border-radius: 4px;
    }

    .styling-group select {
      padding: 8px;
      border: 2px solid #4b5563;
      border-radius: 8px;
      font-size: 0.9rem;
      background: rgba(17, 24, 39, 0.8);
      color: #ffffff;
      cursor: pointer;
      transition: border-color 0.3s ease;
    }

    .styling-group select:focus {
      outline: none;
      border-color: #60a5fa;
      box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2);
    }

    .styling-group input[type="number"] {
      padding: 8px;
      border: 2px solid #4b5563;
      border-radius: 8px;
      font-size: 0.9rem;
      background: rgba(17, 24, 39, 0.8);
      color: #ffffff;
      transition: border-color 0.3s ease;
    }

    .styling-group input[type="number"]:focus {
      outline: none;
      border-color: #60a5fa;
      box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2);
    }

    .styling-group input[type="range"] {
      flex: 1;
      margin-right: 8px;
    }

    #shadowOpacityValue {
      color: #d1d5db;
      font-weight: bold;
      font-size: 0.85rem;
      min-width: 30px;
    }

    .styling-actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    .styling-actions .btn {
      flex: 1;
      min-width: 90px;
      font-size: 0.8rem;
      padding: 10px 14px;
    }

    .subscription-section {
      background: rgba(30, 41, 59, 0.9);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
    }

    .subscription-section h3 {
      color: #ffffff;
      margin-bottom: 12px;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }



    .subscription-list {
      height: 300px;
      overflow-y: auto;
      border: 2px solid #4b5563;
      border-radius: 8px;
      padding: 10px;
      background: rgba(17, 24, 39, 0.6);
    }

    .subscription-item {
      margin-bottom: 8px;
      padding: 8px;
      border-radius: 6px;
      background: rgba(51, 65, 85, 0.8);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      border-left: 3px solid #9146ff;
    }

    .sub-username {
      font-weight: bold;
      color: #9146ff;
      font-size: 0.95rem;
    }

    .sub-details {
      color: #d1d5db;
      font-size: 0.8rem;
      margin: 3px 0;
    }

    .sub-time-added {
      background: #e8f5e8;
      color: #2d7d32;
      padding: 2px 6px;
      border-radius: 3px;
      font-weight: bold;
      font-size: 0.75rem;
      display: inline-block;
    }

    .sub-timestamp {
      color: #9ca3af;
      font-size: 0.75rem;
      float: right;
    }

    .no-subscriptions {
      text-align: center;
      color: #9ca3af;
      font-style: italic;
      padding: 20px 10px;
      font-size: 0.9rem;
    }

    .events-section {
      background: rgba(30, 41, 59, 0.9);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
    }

    .events-section h3 {
      color: #ffffff;
      margin-bottom: 12px;
      font-size: 1.1rem;
    }

    #eventsList {
      height: 300px;
      overflow-y: auto;
      border: 2px solid #4b5563;
      border-radius: 8px;
      padding: 10px;
      background: rgba(17, 24, 39, 0.6);
    }

    .event-item {
      padding: 6px 8px;
      margin-bottom: 6px;
      background: rgba(51, 65, 85, 0.8);
      border-radius: 4px;
      border-left: 3px solid #60a5fa;
      font-size: 0.85rem;
      color: #ffffff;
    }

    .event-time {
      color: #9ca3af;
      font-size: 0.75rem;
    }

    .status-message {
      padding: 10px;
      border-radius: 8px;
      margin-top: 15px;
      text-align: center;
      font-weight: 600;
      font-size: 0.9rem;
      display: none;
    }

    .status-message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status-message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .testing-section {
      background: rgba(30, 41, 59, 0.9);
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .testing-section h3 {
      color: #ffffff;
      margin-bottom: 12px;
      font-size: 1.1rem;
    }

    .testing-controls {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .test-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .test-group label {
      color: #d1d5db;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .test-group input,
    .test-group select {
      padding: 8px;
      border: 1px solid #4b5563;
      border-radius: 6px;
      background: rgba(17, 24, 39, 0.8);
      color: #ffffff;
      font-size: 0.9rem;
    }

    .test-group input:focus,
    .test-group select:focus {
      outline: none;
      border-color: #9146ff;
      box-shadow: 0 0 0 2px rgba(145, 70, 255, 0.2);
    }

    .test-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .test-actions .btn {
      flex: 1;
      min-width: 100px;
      font-size: 0.85rem;
      padding: 8px 12px;
    }



    @media (max-width: 1200px) {
      .content-grid {
        grid-template-columns: 1fr 1fr;
      }

      .events-section {
        grid-column: 1 / -1;
      }
    }

    @media (max-width: 768px) {

      .main-grid,
      .content-grid {
        grid-template-columns: 1fr;
      }

      .settings-grid {
        grid-template-columns: 1fr;
      }

      .timer-display {
        font-size: 2rem;
      }

      .timer-controls {
        flex-direction: column;
      }

      .quick-controls {
        flex-direction: column;
      }

      .quick-add-btn {
        flex: none;
      }

      .manual-timer-controls {
        padding: 12px;
      }

      .manual-timer-inputs {
        flex-direction: column;
        gap: 15px;
        padding: 12px;
      }

      .time-input-group {
        width: 100%;
        max-width: 200px;
        margin: 0 auto;
      }

      .time-input-group input {
        width: 100%;
        height: 50px;
        font-size: 1.3rem;
        padding: 12px;
      }

      .time-input-group label {
        font-size: 0.9rem;
        margin-bottom: 5px;
      }

      .time-separator {
        display: none;
      }
    }
  </style>
</head>

<body>
  <div class="admin-container">
    <div class="header">
      <h1>Penta Subathon Timer</h1>
      <p>Made by @0NEGUY in chat</p>
    </div>

    <div class="main-grid">
      <div class="timer-section">
        <div class="timer-display" id="timerDisplay">52:00:00</div>
        <div class="timer-status" id="timerStatus">
          <code class="bg-gray-800 text-gray-300 px-3 py-2 rounded-md text-sm font-mono">
            OBS Overlay: <a href="https://penta-subathon-timer.emk.dev" target="_blank" class="text-blue-400 hover:text-blue-300">penta-subathon-timer.emk.dev</a>
          </code>
        </div>
        <div class="timer-controls">
          <button class="btn success" id="startBtn" onclick="startTimer()">▶️ Start</button>
          <button class="btn danger" id="stopBtn" onclick="stopTimer()">⏸️ Stop</button>
          <button class="btn secondary" onclick="resetTimer()">🔄 Reset</button>
        </div>
        <div class="quick-controls">
          <button class="quick-add-btn" onclick="addTime(60)">+1m</button>
          <button class="quick-add-btn" onclick="addTime(300)">+5m</button>
          <button class="quick-add-btn" onclick="addTime(600)">+10m</button>
        </div>
        <div class="manual-timer-controls">
          <div class="manual-timer-inputs">
            <div class="time-input-group">
              <input type="number" id="manualHours" min="0" max="99" value="1" placeholder="0">
              <label>Hours</label>
            </div>
            <div class="time-separator">:</div>
            <div class="time-input-group">
              <input type="number" id="manualMinutes" min="0" max="59" value="0" placeholder="0">
              <label>Minutes</label>
            </div>
            <div class="time-separator">:</div>
            <div class="time-input-group">
              <input type="number" id="manualSeconds" min="0" max="59" value="0" placeholder="0">
              <label>Seconds</label>
            </div>
          </div>
          <button class="btn success" onclick="setManualTimer()" style="margin-top: 10px; width: 100%;">Manually Set Timer</button>
        </div>
      </div>

      <div class="settings-panel">
        <h3>⚙️ Settings</h3>
        <div class="settings-grid">
          <div class="setting-group">
            <label for="regularSubTime">Tier 1 Sub (sec):</label>
            <input type="number" id="regularSubTime" value="60" min="0">
          </div>
          <div class="setting-group">
            <label for="tier2SubTime">Tier 2 Sub (sec):</label>
            <input type="number" id="tier2SubTime" value="120" min="0">
          </div>
          <div class="setting-group">
            <label for="tier3SubTime">Tier 3 Sub (sec):</label>
            <input type="number" id="tier3SubTime" value="180" min="0">
          </div>
          <div class="setting-group">
            <label for="primeSubTime">Prime Sub (sec):</label>
            <input type="number" id="primeSubTime" value="60" min="0">
          </div>
        </div>
        <div style="display: flex; gap: 8px; margin-bottom: 10px;">
          <button class="btn success" onclick="saveSettings()" style="flex: 1;">Save</button>

        </div>
      </div>
    </div>

    <div class="content-grid">
      <div class="styling-section">
        <h3>🎨 Timer Styling</h3>
        <div class="styling-controls">
          <div class="styling-group">
            <label for="timerColor">Text Color:</label>
            <input type="color" id="timerColor" value="#60e9b9">
          </div>

          <div class="styling-group">
            <label for="timerFont">Font Family:</label>
            <select id="timerFont">
              <option value="'Nunito', sans-serif">Nunito Sans</option>
              <option value="Arial, sans-serif">Arial</option>
              <option value="'Times New Roman', serif">Times New Roman</option>
              <option value="Georgia, serif">Georgia</option>
              <option value="Verdana, sans-serif">Verdana</option>
              <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
              <option value="'Comic Sans MS', cursive">Comic Sans MS</option>
              <option value="Impact, sans-serif">Impact</option>
              <option value="'Lucida Console', monospace">Lucida Console</option>
              <option value="Tahoma, sans-serif">Tahoma</option>
            </select>
          </div>

          <div class="styling-group">
            <label for="shadowColor">Shadow Color:</label>
            <input type="color" id="shadowColor" value="#000000">
          </div>

          <div class="styling-row">
            <div class="styling-group half">
              <label for="shadowBlur">Shadow Blur (px):</label>
              <input type="number" id="shadowBlur" value="4" min="0" max="20">
            </div>
            <div class="styling-group half">
              <label for="shadowOpacity">Shadow Opacity:</label>
              <input type="range" id="shadowOpacity" value="0.3" min="0" max="1" step="0.1">
              <span id="shadowOpacityValue">0.3</span>
            </div>
          </div>

          <div class="styling-row">
            <div class="styling-group half">
              <label for="shadowX">Shadow X Offset (px):</label>
              <input type="number" id="shadowX" value="2" min="-10" max="10">
            </div>
            <div class="styling-group half">
              <label for="shadowY">Shadow Y Offset (px):</label>
              <input type="number" id="shadowY" value="2" min="-10" max="10">
            </div>
          </div>

          <div class="styling-actions">
            <button class="btn info" onclick="previewTimerStyle()">Preview</button>
            <button class="btn success" onclick="saveTimerStyle()">Save Style</button>
            <button class="btn secondary" onclick="resetTimerStyle()">Reset</button>
          </div>
        </div>
      </div>

      <div class="subscription-section">
        <h3>💜 Recent Subscriptions</h3>
        <div class="subscription-list" id="subscriptionList">
          <div class="no-subscriptions">No subscriptions yet...</div>
        </div>
      </div>

      <div class="events-section">
        <h3>📋 Recent Events</h3>
        <div id="eventsList">
          <p style="color: #666; text-align: center; font-size: 0.9rem;">No recent events</p>
        </div>
      </div>

      <div class="testing-section">
        <h3>🧪 Dev Testing</h3>
        <div class="testing-controls">
          <div class="test-group">
            <label for="testUsername">Username:</label>
            <input type="text" id="testUsername" value="TestUser" placeholder="Enter username">
          </div>

          <div class="test-group">
            <label for="testTier">Tier:</label>
            <select id="testTier">
              <option value="1">Tier 1 ($4.99)</option>
              <option value="2">Tier 2 ($9.99)</option>
              <option value="3">Tier 3 ($24.99)</option>
              <option value="prime">Prime</option>
            </select>
          </div>

          <div class="test-group">
            <label for="testType">Type:</label>
            <select id="testType" onchange="toggleTestFields()">
              <option value="sub">New Sub</option>
              <option value="resub">Resub</option>
              <option value="gift">Gift Sub</option>
            </select>
          </div>

          <div class="test-group" id="giftCountGroup" style="display: none;">
            <label for="testCount">Gift Count:</label>
            <input type="number" id="testCount" value="1" min="1" max="100">
          </div>

          <div class="test-group" id="resubMonthsGroup" style="display: none;">
            <label for="testMonths">Months:</label>
            <input type="number" id="testMonths" value="1" min="1" max="120">
          </div>

          <div class="test-actions">
            <button class="btn success" onclick="simulateSubscription()">Simulate Sub</button>
            <button class="btn info" onclick="simulateGiftBomb()">Gift Bomb (10)</button>
            <button class="btn secondary" onclick="simulateRandomSub()">Random Sub</button>
          </div>
        </div>
      </div>
    </div>

    <div class="status-message" id="statusMessage"></div>
  </div>

  <script>
    let ws
    let timerData = { timeRemaining: 3600, isActive: false }
    const events = []
    const subscriptions = []
    let currentTimerStyle = {
      color: '#60e9b9',
      fontFamily: "'Courier New', monospace",
      shadowColor: '#000000',
      shadowBlur: 4,
      shadowOpacity: 0.3,
      shadowX: 2,
      shadowY: 2
    }

    // LocalStorage management functions (only for timer data, settings, and styling)
    const LocalStorageKeys = {
      TIMER_DATA: 'penta_timer_data',
      SETTINGS: 'penta_settings',
      TIMER_STYLE: 'penta_timer_style'
    }

    function saveToLocalStorage(key, data) {
      try {
        localStorage.setItem(key, JSON.stringify(data))
      } catch (error) {
        console.warn('Failed to save to localStorage:', error)
      }
    }

    function loadFromLocalStorage(key, defaultValue = null) {
      try {
        const data = localStorage.getItem(key)
        return data ? JSON.parse(data) : defaultValue
      } catch (error) {
        console.warn('Failed to load from localStorage:', error)
        return defaultValue
      }
    }

    function saveTimerData() {
      saveToLocalStorage(LocalStorageKeys.TIMER_DATA, timerData)
    }

    function loadTimerData() {
      const saved = loadFromLocalStorage(LocalStorageKeys.TIMER_DATA)
      if (saved) {
        timerData = { ...timerData, ...saved }
        updateTimerDisplay()
      }
    }

    function saveSettingsToStorage() {
      const settings = {
        regularSubTime: parseInt(document.getElementById('regularSubTime').value),
        tier2SubTime: parseInt(document.getElementById('tier2SubTime').value),
        tier3SubTime: parseInt(document.getElementById('tier3SubTime').value),
        primeSubTime: parseInt(document.getElementById('primeSubTime').value),
      }
      saveToLocalStorage(LocalStorageKeys.SETTINGS, settings)
      return settings
    }

    function loadSettings() {
      const saved = loadFromLocalStorage(LocalStorageKeys.SETTINGS)
      if (saved) {
        if (saved.regularSubTime !== undefined) document.getElementById('regularSubTime').value = saved.regularSubTime
        if (saved.tier2SubTime !== undefined) document.getElementById('tier2SubTime').value = saved.tier2SubTime
        if (saved.tier3SubTime !== undefined) document.getElementById('tier3SubTime').value = saved.tier3SubTime
        if (saved.primeSubTime !== undefined) document.getElementById('primeSubTime').value = saved.primeSubTime
      }
    }

    function saveTimerStyleToStorage() {
      saveToLocalStorage(LocalStorageKeys.TIMER_STYLE, currentTimerStyle)
    }

    function loadTimerStyleFromStorage() {
      const saved = loadFromLocalStorage(LocalStorageKeys.TIMER_STYLE)
      if (saved) {
        currentTimerStyle = { ...currentTimerStyle, ...saved }
        // Update form controls
        document.getElementById('timerColor').value = currentTimerStyle.color
        document.getElementById('timerFont').value = currentTimerStyle.fontFamily
        document.getElementById('shadowColor').value = currentTimerStyle.shadowColor
        document.getElementById('shadowBlur').value = currentTimerStyle.shadowBlur
        document.getElementById('shadowOpacity').value = currentTimerStyle.shadowOpacity
        document.getElementById('shadowX').value = currentTimerStyle.shadowX
        document.getElementById('shadowY').value = currentTimerStyle.shadowY
        updateShadowOpacityDisplay()
        applyTimerStyle()
      }
    }

    // Initialize WebSocket connection
    function initWebSocket() {
      const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:'
      ws = new WebSocket(`${protocol}//${window.location.host}`)

      ws.onopen = () => {
        console.log('WebSocket connected')
        addEvent('System', 'Connected to server')
      }

      ws.onmessage = (event) => {
        const data = JSON.parse(event.data)
        handleWebSocketMessage(data)
      }

      ws.onclose = () => {
        console.log('WebSocket disconnected')
        addEvent('System', 'Disconnected from server')
        setTimeout(initWebSocket, 3000) // Reconnect after 3 seconds
      }
    }

    // Handle WebSocket messages
    function handleWebSocketMessage(data) {
      switch (data.type) {
        case 'timer_update':
        case 'timer_started':
        case 'timer_stopped':
        case 'timer_reset':
        case 'time_added':
          timerData = { timeRemaining: data.timeRemaining, isActive: data.isActive }
          updateTimerDisplay()
          saveTimerData() // Save to localStorage

          if (data.type === 'time_added') {
            addEvent('Timer', `Added ${data.addedTime} seconds`)
          } else if (data.type === 'timer_started') {
            addEvent('Timer', 'Timer started')
          } else if (data.type === 'timer_stopped') {
            addEvent('Timer', 'Timer stopped')
          } else if (data.type === 'timer_reset') {
            addEvent('Timer', 'Timer reset')
          }
          break

        case 'subscription':
          const subType = data.tierName || 'Unknown'
          const countText = data.subCount > 1 ? ` x${data.subCount}` : ''
          const recipientText = data.recipient ? ` to ${data.recipient}` : ''
          addEvent('Subscription', `${data.username} ${data.msgId} (${subType})${countText}${recipientText} - +${data.timeAdded}s`)
          addSubscription(data)
          break

        case 'timer_ended':
          timerData = { timeRemaining: 0, isActive: false }
          updateTimerDisplay()
          saveTimerData() // Save to localStorage
          addEvent('Timer', '🚨 TIMER ENDED! 🚨')
          break
      }
    }

    // Format time display
    function formatTime(seconds) {
      const hours = Math.floor(seconds / 3600)
      const minutes = Math.floor((seconds % 3600) / 60)
      const secs = seconds % 60
      return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
    }

    // Update timer display
    function updateTimerDisplay() {
      document.getElementById('timerDisplay').textContent = formatTime(timerData.timeRemaining)
      // Update button states
      document.getElementById('startBtn').disabled = timerData.isActive
      document.getElementById('stopBtn').disabled = !timerData.isActive
    }

    // Add event to list
    function addEvent(source, message) {
      const event = {
        source,
        message,
        time: new Date().toLocaleTimeString()
      }

      events.push(event)
      if (events.length > 20) events.pop() // Keep only last 20 events

      updateEventsList()
    }

    // Update events list display
    function updateEventsList() {
      const eventsList = document.getElementById('eventsList')
      if (events.length === 0) {
        eventsList.innerHTML = '<p style="color: #9ca3af; text-align: center;">No recent events</p>'
        return
      }

      eventsList.innerHTML = events.map(event => `
                <div class="event-item">
                    <strong>${event.source}:</strong> ${event.message}
                    <div class="event-time">${event.time}</div>
                </div>
            `).join('')
    }

    // Timer styling functions
    function applyTimerStyle(style = currentTimerStyle) {
      const timerDisplay = document.getElementById('timerDisplay')
      const shadowRgba = hexToRgba(style.shadowColor, style.shadowOpacity)

      timerDisplay.style.color = style.color
      timerDisplay.style.fontFamily = style.fontFamily
      timerDisplay.style.textShadow = `${style.shadowX}px ${style.shadowY}px ${style.shadowBlur}px ${shadowRgba}`
    }

    function hexToRgba(hex, opacity) {
      const r = parseInt(hex.slice(1, 3), 16)
      const g = parseInt(hex.slice(3, 5), 16)
      const b = parseInt(hex.slice(5, 7), 16)
      return `rgba(${r}, ${g}, ${b}, ${opacity})`
    }

    function updateShadowOpacityDisplay() {
      const opacityValue = document.getElementById('shadowOpacity').value
      document.getElementById('shadowOpacityValue').textContent = opacityValue
    }

    function previewTimerStyle() {
      const style = {
        color: document.getElementById('timerColor').value,
        fontFamily: document.getElementById('timerFont').value,
        shadowColor: document.getElementById('shadowColor').value,
        shadowBlur: parseInt(document.getElementById('shadowBlur').value),
        shadowOpacity: parseFloat(document.getElementById('shadowOpacity').value),
        shadowX: parseInt(document.getElementById('shadowX').value),
        shadowY: parseInt(document.getElementById('shadowY').value)
      }

      applyTimerStyle(style)
      showStatus('Style preview applied! Click "Save Style" to make it permanent.')
    }

    async function saveTimerStyle() {
      const style = {
        timerColor: document.getElementById('timerColor').value,
        timerFont: document.getElementById('timerFont').value,
        timerShadowColor: document.getElementById('shadowColor').value,
        timerShadowBlur: parseInt(document.getElementById('shadowBlur').value),
        timerShadowOpacity: parseFloat(document.getElementById('shadowOpacity').value),
        timerShadowX: parseInt(document.getElementById('shadowX').value),
        timerShadowY: parseInt(document.getElementById('shadowY').value)
      }

      // Update current timer style and save to localStorage immediately
      currentTimerStyle = {
        color: style.timerColor,
        fontFamily: style.timerFont,
        shadowColor: style.timerShadowColor,
        shadowBlur: style.timerShadowBlur,
        shadowOpacity: style.timerShadowOpacity,
        shadowX: style.timerShadowX,
        shadowY: style.timerShadowY
      }
      applyTimerStyle()
      saveTimerStyleToStorage()

      try {
        const response = await fetch('/api/settings', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(style)
        })
        const result = await response.json()
        if (result.success) {
          showStatus('Timer style saved successfully!')
        } else {
          showStatus(result.message, true)
        }
      } catch (error) {
        showStatus('Timer style saved locally (server sync failed)', false)
      }
    }

    function resetTimerStyle() {
      // Reset to default values
      document.getElementById('timerColor').value = '#60e9b9'
      document.getElementById('timerFont').value = "'Nunito', sans-serif"
      document.getElementById('shadowColor').value = '#000000'
      document.getElementById('shadowBlur').value = 4
      document.getElementById('shadowOpacity').value = 0.3
      document.getElementById('shadowX').value = 2
      document.getElementById('shadowY').value = 2

      updateShadowOpacityDisplay()
      previewTimerStyle()
    }

    function loadTimerStyle(settings) {
      if (settings.timerColor) {
        document.getElementById('timerColor').value = settings.timerColor
        currentTimerStyle.color = settings.timerColor
      }
      if (settings.timerFont) {
        document.getElementById('timerFont').value = settings.timerFont
        currentTimerStyle.fontFamily = settings.timerFont
      }
      if (settings.timerShadowColor) {
        document.getElementById('shadowColor').value = settings.timerShadowColor
        currentTimerStyle.shadowColor = settings.timerShadowColor
      }
      if (settings.timerShadowBlur !== undefined) {
        document.getElementById('shadowBlur').value = settings.timerShadowBlur
        currentTimerStyle.shadowBlur = settings.timerShadowBlur
      }
      if (settings.timerShadowOpacity !== undefined) {
        document.getElementById('shadowOpacity').value = settings.timerShadowOpacity
        currentTimerStyle.shadowOpacity = settings.timerShadowOpacity
        updateShadowOpacityDisplay()
      }
      if (settings.timerShadowX !== undefined) {
        document.getElementById('shadowX').value = settings.timerShadowX
        currentTimerStyle.shadowX = settings.timerShadowX
      }
      if (settings.timerShadowY !== undefined) {
        document.getElementById('shadowY').value = settings.timerShadowY
        currentTimerStyle.shadowY = settings.timerShadowY
      }

      applyTimerStyle()
    }

    // Add subscription to list
    function addSubscription(data) {
      const subscription = {
        username: data.username,
        msgId: data.msgId,
        subPlan: data.subPlan,
        tierName: data.tierName,
        timeAdded: data.timeAdded,
        subCount: data.subCount || 1,
        subType: data.subType || 'subscription',
        recipient: data.recipient || null,
        months: data.months || null,
        timestamp: new Date().toLocaleTimeString()
      }

      subscriptions.unshift(subscription)
      if (subscriptions.length > 20) subscriptions.pop() // Keep only last 20 subscriptions

      updateSubscriptionDisplay()
    }

    // Update subscription display
    function updateSubscriptionDisplay() {
      const subList = document.getElementById('subscriptionList')

      if (subscriptions.length === 0) {
        subList.innerHTML = '<div class="no-subscriptions">No subscriptions yet...</div>'
        return
      }

      subList.innerHTML = subscriptions.map(sub => {
        const tierDisplay = sub.tierName || (sub.subPlan === 'Prime' ? 'Prime' : 'Unknown')

        let actionDisplay
        if (sub.msgId === 'subgift') {
          actionDisplay = sub.subCount > 1 ? `${sub.subCount} Gift Subs` : 'Gift Sub'
          if (sub.recipient) actionDisplay += ` to ${sub.recipient}`
        } else if (sub.msgId === 'resub') {
          actionDisplay = sub.months ? `Resub (${sub.months}mo)` : 'Resub'
        } else {
          actionDisplay = 'New Sub'
        }

        const subTypeDisplay = `${actionDisplay} (${tierDisplay})`

        return `
          <div class="subscription-item">
            <div class="sub-username">${sub.username}</div>
            <div class="sub-details">${subTypeDisplay}</div>
            <span class="sub-time-added">+${sub.timeAdded}s</span>
            <span class="sub-timestamp">${sub.timestamp}</span>
          </div>
        `
      }).join('')

      // Auto-scroll to top to show latest subscription
      subList.scrollTop = 0
    }



    // Show status message
    function showStatus(message, isError = false) {
      const statusEl = document.getElementById('statusMessage')
      statusEl.textContent = message
      statusEl.className = `status-message ${isError ? 'error' : 'success'}`
      statusEl.style.display = 'block'

      setTimeout(() => {
        statusEl.style.display = 'none'
      }, 3000)
    }

    // API functions
    async function startTimer() {
      try {
        const response = await fetch('/api/timer/start', { method: 'POST' })
        const result = await response.json()
        if (result.success) {
          showStatus(result.message)
        } else {
          showStatus(result.message, true)
        }
      } catch (error) {
        showStatus('Failed to start timer', true)
      }
    }

    async function stopTimer() {
      try {
        const response = await fetch('/api/timer/stop', { method: 'POST' })
        const result = await response.json()
        if (result.success) {
          showStatus(result.message)
        } else {
          showStatus(result.message, true)
        }
      } catch (error) {
        showStatus('Failed to stop timer', true)
      }
    }

    async function resetTimer() {
      const time = prompt('Reset timer to (seconds):', '3600')
      if (time === null) return

      try {
        const response = await fetch('/api/timer/reset', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ time: parseInt(time) })
        })
        const result = await response.json()
        if (result.success) {
          showStatus(result.message)
        } else {
          showStatus(result.message, true)
        }
      } catch (error) {
        showStatus('Failed to reset timer', true)
      }
    }

    async function setManualTimer() {
      const hours = parseInt(document.getElementById('manualHours').value) || 0
      const minutes = parseInt(document.getElementById('manualMinutes').value) || 0
      const seconds = parseInt(document.getElementById('manualSeconds').value) || 0

      // Validate inputs
      if (hours < 0 || hours > 99) {
        showStatus('Hours must be between 0 and 99', true)
        return
      }
      if (minutes < 0 || minutes > 59) {
        showStatus('Minutes must be between 0 and 59', true)
        return
      }
      if (seconds < 0 || seconds > 59) {
        showStatus('Seconds must be between 0 and 59', true)
        return
      }

      // Calculate total seconds
      const totalSeconds = (hours * 3600) + (minutes * 60) + seconds

      if (totalSeconds === 0) {
        showStatus('Timer cannot be set to 0', true)
        return
      }

      try {
        const response = await fetch('/api/timer/reset', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ time: totalSeconds })
        })
        const result = await response.json()
        if (result.success) {
          showStatus(`Timer set to ${formatTime(totalSeconds)}`)
        } else {
          showStatus(result.message, true)
        }
      } catch (error) {
        showStatus('Failed to set timer', true)
      }
    }

    async function addTime(seconds) {
      try {
        const response = await fetch('/api/timer/add', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ seconds })
        })
        const result = await response.json()
        if (result.success) {
          showStatus(result.message)
        } else {
          showStatus(result.message, true)
        }
      } catch (error) {
        showStatus('Failed to add time', true)
      }
    }

    async function saveSettings() {
      // Save to localStorage immediately
      const settings = saveSettingsToStorage()

      try {
        const response = await fetch('/api/settings', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(settings)
        })
        const result = await response.json()
        if (result.success) {
          showStatus(result.message)
        } else {
          showStatus(result.message, true)
        }
      } catch (error) {
        showStatus('Settings saved locally (server sync failed)', false)
      }
    }

    async function saveDisplaySettings() {
      const timerSize = parseInt(document.getElementById('timerSize').value)

      if (timerSize < 50 && timerSize !== 0) {
        showStatus('Timer size must be at least 50 pixels or 0 for responsive', true)
        return
      }

      const settings = {
        timerSize: timerSize
      }

      try {
        const response = await fetch('/api/settings', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(settings)
        })
        const result = await response.json()
        if (result.success) {
          showStatus('Display settings saved! Timer size updated.')
        } else {
          showStatus(result.message, true)
        }
      } catch (error) {
        showStatus('Failed to save display settings', true)
      }
    }

    async function resetToResponsive() {
      document.getElementById('timerSize').value = 0
      await saveDisplaySettings()
    }

    // Load initial data
    async function loadInitialData() {
      // First, load from localStorage (immediate)
      loadTimerData()
      loadSettings()
      loadTimerStyleFromStorage()

      // Then sync with server (may update localStorage if server has newer data)
      try {
        // Load timer state from server
        const timerResponse = await fetch('/api/timer')
        const serverTimerData = await timerResponse.json()

        // Only update if server data seems more recent or localStorage is empty
        if (!loadFromLocalStorage(LocalStorageKeys.TIMER_DATA) ||
          serverTimerData.timeRemaining !== timerData.timeRemaining) {
          timerData = serverTimerData
          updateTimerDisplay()
          saveTimerData()
        }

        // Load settings from server
        const settingsResponse = await fetch('/api/settings')
        const serverSettings = await settingsResponse.json()

        // Update form fields with server settings if available
        if (serverSettings.regularSubTime !== undefined) {
          document.getElementById('regularSubTime').value = serverSettings.regularSubTime
        }
        if (serverSettings.tier2SubTime !== undefined) {
          document.getElementById('tier2SubTime').value = serverSettings.tier2SubTime
        }
        if (serverSettings.tier3SubTime !== undefined) {
          document.getElementById('tier3SubTime').value = serverSettings.tier3SubTime
        }
        if (serverSettings.primeSubTime !== undefined) {
          document.getElementById('primeSubTime').value = serverSettings.primeSubTime
        }

        // Load timer styling from server
        loadTimerStyle(serverSettings)

        // Save any server settings to localStorage
        saveSettingsToStorage()

        addEvent('System', 'Data synced with server')

      } catch (error) {
        console.error('Failed to load server data:', error)
        addEvent('System', 'Using offline data (server unavailable)')
      }
    }

    // Initialize everything
    window.addEventListener('load', () => {
      initWebSocket()
      loadInitialData()

      // Add event listener for shadow opacity slider
      document.getElementById('shadowOpacity').addEventListener('input', updateShadowOpacityDisplay)

      // Apply initial timer style
      applyTimerStyle()

      // Periodically save timer data (every 10 seconds) in case of unexpected page close
      setInterval(() => {
        if (timerData.isActive) {
          saveTimerData()
        }
      }, 10000)

      // Save data when page is about to unload
      window.addEventListener('beforeunload', () => {
        saveTimerData()
        saveSettingsToStorage()
        saveTimerStyleToStorage()
      })
    });
  </script>
</body>

</html>